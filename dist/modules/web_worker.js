class Etalon{constructor(){this.sum3Parameters={value:0,percent:0,name:"Броня+Урон+Шок",commandValue:0,commandPercent:0,calculate:0},this.allParameters={value:0,percent:0,name:"Сумма всех",commandValue:0,commandPercent:0,calculate:0},this.allDamage={value:0,percent:0,name:"Общий урон",commandValue:0,commandPercent:0,calculate:2},this.damagePhisical={value:0,percent:0,name:"Урон (Физич.)",commandValue:0,commandPercent:0,calculate:1},this.damagePoison={value:0,percent:0,name:"Урон (Яд)",commandValue:0,commandPercent:0,calculate:1},this.damageElectricity={value:0,percent:0,name:"Урон (Электр.)",commandValue:0,commandPercent:0,calculate:1},this.damageWater={value:0,percent:0,name:"Урон (Вода)",commandValue:0,commandPercent:0,calculate:1},this.damageFair={value:0,percent:0,name:"Урон (Огонь)",commandValue:0,commandPercent:0,calculate:1},this.damageDead={value:0,percent:0,name:"Урон (Смерть)",commandValue:0,commandPercent:0,calculate:1},this.damageAstral={value:0,percent:0,name:"Урон (Астрал.)",commandValue:0,commandPercent:0,calculate:1},this.initiative={value:0,percent:0,name:"Инициатива",commandValue:0,commandPercent:0,calculate:2},this.accuracy={value:0,percent:0,name:"Точность атаки",commandValue:0,commandPercent:0,calculate:2},this.shock={value:0,percent:0,name:"Шоковая атака",commandValue:0,commandPercent:0,calculate:2},this.antiShock={value:0,percent:0,name:"Устойчивость к шоку",commandValue:0,commandPercent:0,calculate:2},this.generalProtection={value:0,percent:0,name:"Общая защита",commandValue:0,commandPercent:0,calculate:2},this.resistancePhysical={value:0,percent:0,name:"Сопр. (Физич.)",commandValue:0,commandPercent:0,calculate:2},this.poisonResistance={value:0,percent:0,name:"Сопр. (Яд)",commandValue:0,commandPercent:0,calculate:2},this.electricityResistance={value:0,percent:0,name:"Сопр. (Электр.)",commandValue:0,commandPercent:0,calculate:2},this.waterResistance={value:0,percent:0,name:"Сопр. (Вода)",commandValue:0,commandPercent:0,calculate:2},this.fairResistance={value:0,percent:0,name:"Сопр. (Огонь)",commandValue:0,commandPercent:0,calculate:2},this.deadResistance={value:0,percent:0,name:"Сопр. (Смерть)",commandValue:0,commandPercent:0,calculate:2},this.breakdownOfGeneralProtection={value:0,percent:0,name:"Пробой общей защиты",commandValue:0,commandPercent:0,calculate:2},this.breakdownOfPhysicalProtection={value:0,percent:0,name:"Пробой сопр. физ. урону",commandValue:0,commandPercent:0,calculate:2},this.breakdownOfPoisonProtection={value:0,percent:0,name:"Пробой сопр. яду",commandValue:0,commandPercent:0,calculate:2},this.breakdownOfElectricityProtection={value:0,percent:0,name:"Пробой сопр. электричеству",commandValue:0,commandPercent:0,calculate:2},this.breakdownOfWaterProtection={value:0,percent:0,name:"Пробой сопр. воде",commandValue:0,commandPercent:0,calculate:2},this.breakdownOfFairProtection={value:0,percent:0,name:"Пробой сопр. огню",commandValue:0,commandPercent:0,calculate:2},this.breakdownOfDeadProtection={value:0,percent:0,name:"Пробой сопр. смерти",commandValue:0,commandPercent:0,calculate:2},this.hp={value:0,percent:0,name:"Здоровье",commandValue:0,commandPercent:0,calculate:2},this.damage={value:0,percent:0,name:"Урон",commandValue:0,commandPercent:0,calculate:1}}countSomeParameters(){Object.keys(this).forEach((e=>{this[e].value&&this[e].percent&&(this[e].value+=Math.ceil(this[e].value*this[e].percent/100))})),this.allDamage.value=Object.keys(this).filter((e=>1===this[e].calculate)).reduce(((e,a)=>e+this[a].value),0),this.sum3Parameters.value=this.allDamage.value+this.generalProtection.value+this.shock.value,this.allParameters.value=Object.keys(this).filter((e=>2===this[e].calculate)).reduce(((e,a)=>e+(!this[a].value&&this[a].percent?this[a].percent:this[a].value?this[a].value:0)),0)}}const findMaxValues=(e,a)=>{Object.keys(e).forEach((t=>{"object"!=typeof e[t]||e[t]instanceof Array||["value","percent","commandValue","commandPercent"].forEach((n=>{e[t][n]>a[t][n]&&(a[t][n]=e[t][n])}))}))};onmessage=e=>{const a=e.data.object,t=new Etalon,n=e.data.func,c=e.data.filter,m=e.data.fields,l=[],r=e.data.count,u=e.data.paramForms;let s;"find_all_variants"!=n&&"top_values"!=n||(s=e.data.forms,s=s.filter((e=>Number(e.value)>0)));const o=[],h=[[],[],[],[],[],[],[],[],[],[]],i=(e,a)=>{let t=!0;return a.forEach((a=>{let n=Number(a.value);a.command?(n&&!e[`${a.name}`].commandValue&&!e[`${a.name}`].commandPercent||e[`${a.name}`].commandValue&&n>e[`${a.name}`].commandValue||e[`${a.name}`].commandPercent&&n>e[`${a.name}`].commandPercent)&&(t=!1):(n&&!e[`${a.name}`].value&&!e[`${a.name}`].percent||e[`${a.name}`].value&&n>e[`${a.name}`].value||e[`${a.name}`].percent&&n>e[`${a.name}`].percent)&&(t=!1)})),t},d=e=>{const a=new Etalon;a.num=[];let t=0,n=0;return e.forEach(((e,c)=>{2==e.complect&&++t,3==e.complect&&++n,Object.keys(e).forEach((t=>{"object"==typeof e[t]&&t in a?(a[t].value+=e[t].value,a[t].percent+=e[t].percent,a[t].commandValue+=e[t].commandValue,a[t].commandPercent+=e[t].commandPercent):"num"===t&&a.num.push(e.num)}))})),t>=3&&(a.damage.value+=3,a.accuracy.value+=2,a.damage.percent+=3,a.damage.commandPercent+=3),n>=3&&(a.damage.percent+=10,a.generalProtection.value+=10,a.hp.value+=130,a.damage.value+=10,a.hp.commandValue+=30),a.countSomeParameters(),a};a.forEach(((e,a,t)=>{t[a].num=a,h[t[a].type-1].push(a)}));const v=(e,a)=>0==a?e:e+v(a,a-1),g=function(e){for(var a=arguments.length,t=new Array(a>1?a-1:0),n=1;n<a;n++)t[n-1]=arguments[n];return t.reduce(((e,a)=>e*a),e)},p=[];let P;c.includes("swords")?(p.push([{num:0,start:0},{num:1,start:0},{num:2,start:0},{num:3,start:0},{num:5,start:0},{num:6,start:0},{num:7,start:0},{num:8,start:0}]),P=g(v(h[4].length-1,h[4].length-2),h[0].length,h[1].length,h[2].length,h[3].length,h[5].length,h[6].length,h[7].length,h[8].length)):c.includes("spears")?(p.push([{num:0,start:0},{num:2,start:0},{num:3,start:0},{num:5,start:0},{num:6,start:0},{num:8,start:0},{num:9,start:0}]),P=g(v(h[4].length-1,h[4].length-2),h[0].length,h[2].length,h[3].length,h[5].length,h[6].length,h[8].length,h[9].length)):c.includes("all")?(p.push([{num:0,start:0},{num:1,start:0},{num:2,start:0},{num:3,start:0},{num:5,start:0},{num:6,start:0},{num:7,start:0},{num:8,start:0}]),p.push([{num:0,start:0},{num:2,start:0},{num:3,start:0},{num:5,start:0},{num:6,start:0},{num:8,start:0},{num:9,start:0}]),P=g(v(h[4].length-1,h[4].length-2),h[0].length,h[1].length,h[2].length,h[3].length,h[5].length,h[6].length,h[7].length,h[8].length)+g(v(h[4].length-1,h[4].length-2),h[0].length,h[2].length,h[3].length,h[5].length,h[6].length,h[8].length,h[9].length)):console.log("Error!");let f=1,V=0;const b=Math.trunc(P/100);switch(p.forEach((e=>{for(let c=0;c<h[4].length-1;c++)for(let v=c+1;v<h[4].length;v++){let g=e.length-2;for(;;){switch(o.length=0,o.push(h[4][c]),o.push(h[4][v]),e.forEach((e=>{o.push(h[e.num][e.start])})),++V==b&&(V=0,postMessage(++f)),n){case"count_max_values":findMaxValues(d(o.slice(0).map((e=>a[e]))),t);break;case"find_all_variants":i(d(o.slice(0).map((e=>a[e]))),s)&&postMessage(d(o.slice(0).map((e=>a[e]))));break;case"top_values":const e=d(o.slice(0).map((e=>a[e])));let n=0;m.forEach((a=>{a.includes("command")?0!=e[a.substring(7).trim()].commandValue?n+=e[a.substring(7).trim()].commandValue:n+=e[a.substring(7).trim()].commandPercent:0!=e[a].value?n+=e[a].value:n+=e[a].percent})),i(Object.assign({},e),s)&&u.includes("yes")||u.includes("no")?e.sum3Parameters.value=n:e.sum3Parameters.value=0,0!=e.sum3Parameters.value&&(l.length<r?(l.push(e),l.length==r&&l.sort(((e,a)=>e.sum3Parameters.value-a.sum3Parameters.value)).reverse()):e.sum3Parameters.value>l[r-1].sum3Parameters.value&&(l[r-1]=Object.assign({},e),l.sort(((e,a)=>e.sum3Parameters.value-a.sum3Parameters.value)).reverse()))}let p=!1;for(let a=e.length-1;a>=g;a--){if(-1==g){p=!0;break}if(e[a].start=e[a].start+1,e[a].start<h[e[a].num].length)break;e[a].start=0,a==g&&--g}if(p)break}}})),n){case"count_max_values":postMessage(t);break;case"find_all_variants":postMessage(null);break;case"top_values":postMessage(l)}};